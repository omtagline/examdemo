<div class="p-2">
  <form [formGroup]="examForm" (ngSubmit)="examFormSubmit()">
    <div class="col-6 p-2">
      <label for="name">Subject Name</label>
      <input
        id="name"
        type="text"
        class="form-control"
        formControlName="subjectName"
        placeholder="Subject Name"
      />
      @if (examForm.get('subjectName')?.invalid
      &&examForm.get('subjectName')?.touched ) {
      <span class="error">Subject Name Required</span>
      }
    </div>
    <div formArrayName="questions" class="p-2">
      @for (item of getQuestionArray.controls; track item;let i=$index) {
      <div class="" [formGroupName]="i">
        <div class="border p-2 mt-2 rounded">
          <div class="col-12">
            <div class="row align-items-center">
              <div class="col-10">
                <label for="question">
                  <span class="m-2 fs-5 fw-bold">{{ i + 1 + "." }}</span>
                  Question:</label
                >
                <input
                  type="text"
                  name="question"
                  id="question"
                  class="form-control"
                  placeholder="Question"
                  formControlName="question"
                />
              </div>
              <div class="col-auto align-self-end">
                <button class="btn-dark btn" type="button" (click)="add()">
                  <i class="bi bi-plus-lg"></i>
                </button>
              </div>

              @if (getQuestionArray.length>1) {
              <div class="col-auto align-self-end">
                <button
                  class="btn-danger btn"
                  type="button"
                  (click)="remove(i)"
                >
                  <i class="bi bi-trash-fill"></i>
                </button>
              </div>
              } @if ( item.get('question')?.invalid &&
              item.get('question')?.touched ) {
              <span class="error ps-3">question is Required</span>
              }
            </div>
          </div>

          <div formArrayName="options" class="mb-3">
            <div class="row">
              <label for="option">Option:</label>
              <!-- {{ getQuestionArray | json }} -->
              @for (option of getOptionArray(i).controls; track $index) {
              <div class="col-6 mt-2">
                <div class="input-group">
                  <input
                    type="radio"
                    class="form-check me-2"
                    [name]="i"
                    (change)="radioChange($index, i)"
                  />
                  <input
                    type="text"
                    id="opetion"
                    (change)="radioChange($index, i)"
                    [placeholder]="$index + 65 | charTostr"
                    class="form-control"
                    [formControlName]="$index"
                  />
                </div>

                @if ( option.invalid && option.touched ) {
                <span class="error ps-4"
                  >{{ $index + 65 | charTostr }} Is Required</span
                >
                }
              </div>
              }
            </div>
          </div>
        </div>
      </div>
      @if (getQuestionArray.controls[i].get("question")?.invalid
      &&getQuestionArray.controls[i].get("question")?.touched ) {
      <span class="error"> Question Is Invalid</span>
      } }
    </div>
    <div formArrayName="notes">
      @for (notes of getNotesArray.controls; track $index) {
      <div class="col-6">
        <div class="row align-items-center">
          <div class="col-6">
            <label for="notes">notes:</label>
            <input
              type="text"
              name="notes"
              [formControlName]="$index"
              [id]="'note' + $index"
              class="form-control"
              placeholder="notes"
            />
          </div>

          <div class="col-auto align-self-end">
            <button class="btn-dark btn" type="button" (click)="addNotes()">
              <i class="bi bi-plus-lg"> </i>
            </button>
          </div>
          @if (notes.invalid && notes.touched) {
          <span class="error"> Notes Is Required</span>
          } @if (getNotesArray.controls.length>1) {
          <div class="col-auto align-self-end">
            <button
              class="btn-danger btn"
              type="button"
              (click)="removeNotes($index)"
            >
              <i class="bi bi-trash-fill"></i>
            </button>
          </div>
          }
        </div>
      </div>
      }
    </div>
    <div>
      <ng-toast [width]="300" />
    </div>
    @if (id) {
    <div class="mt-3 d-flex align-content-center justify-content-center col-3">
      <button
        class="btn btn-dark"
        type="button"
        (click)="examUpdate()"
        [disabled]="examForm.invalid"
      >
        Update Exam
      </button>
    </div>
    }@else {
    <div class="mt-3 d-flex align-content-center justify-content-center col-3">
      <button class="btn btn-dark" type="submit" [disabled]="examForm.invalid">
        Create Exam
      </button>
    </div>
    }
  </form>
</div>
